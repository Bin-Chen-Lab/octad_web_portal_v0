<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Octad</title>
	<link rel="shortcut icon" href="{{ url_for('static', filename='img/optraIcon.png') }}" type="image/x-icon">
	<link href="{{ url_for('static', filename='css/bootstrap.min.css') }}" rel="stylesheet">
	<link href="{{ url_for('static', filename='css/jquery-ui.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='font-awesome/css/font-awesome.css') }}" rel="stylesheet">
	<link href="{{ url_for('static', filename='css/plugins/steps/jquery.steps.css') }}" rel="stylesheet">
	<link href="{{ url_for('static', filename='css/sumoselect.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/animate.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
	<link href="{{ url_for('static', filename='css/plugins/iCheck/custom.css') }}" rel="stylesheet">
	<link href="{{ url_for('static', filename='css/sumoselect.css') }}" rel="stylesheet">
	<link href="{{ url_for('static', filename='css/plugins/select2/select2.min.css') }}" rel="stylesheet"><!-- Auto Select -->
	<link href="{{ url_for('static', filename='css/plugins/chosen/bootstrap-chosen.css') }}" rel="stylesheet"><!-- Multi Select -->
	<link href="{{ url_for('static', filename='css/plugins/nouslider/jquery.nouislider.css') }}" rel="stylesheet"><!-- no ui slider -->
	<link href="{{ url_for('static', filename='css/plugins/switchery/switchery.css') }}" rel="stylesheet"><!-- switchery (On Off Button) -->
	<link href="{{ url_for('static', filename='css/cstm-style.css') }}" rel="stylesheet">
	<link href="{{ url_for('static', filename='css/jquery.dataTables.min.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/sweetalert.css') }}" rel="stylesheet">
	<style type="text/css">.ui-autocomplete { height: 200px; overflow-y: scroll; overflow-x: hidden;}

	table.dataTable tr th.select-checkbox.selected::after {
    content: "âœ”";
    margin-top: -11px;
    margin-left: -4px;
    text-align: center;
    text-shadow: rgb(176, 190, 217) 1px 1px, rgb(176, 190, 217) -1px -1px, rgb(176, 190, 217) 1px -1px, rgb(176, 190, 217) -1px 1px;
	}
</style>
</head>

<body class=""><!-- mini-navbar -->
    <div id="wrapper">
	    <nav class="navbar-default navbar-static-side sideNav" role="navigation"><!-- bottomNav -->
	        <div class="sidebar-collapse">
	            <ul class="nav metismenu tooltip-demo" id="side-menu">
					<li class="active" data-container="body">
	                    <a href="{{ url_for('dashboard.dashboard') }}">
	                    	<i class="fa fa-step-forward" aria-hidden="true"></i>
	                    	<span class="nav-label">Steps - New Jobs</span>
	                    </a>
	                </li>
					<li data-container="body">
	                    <a href="{{ url_for('dashboard.job_history') }}">
	                    	<i class="fa fa-tasks" aria-hidden="true"></i>
	                    	<span class="nav-label">Job History</span>
	                    </a>
	                </li>
	                <li data-container="body">
	                    <a href="{{ url_for('dashboard.dataset') }}"><i class="fa fa-database" aria-hidden="true"></i> <span class="nav-label">Dataset</span></a>
	                </li>
	                <li>
	                    <a href="{{ url_for('dashboard.code') }}"><i class="fa fa-code" aria-hidden="true"></i> <span class="nav-label">Code</span></a>
	                </li>
	                <li>
	                    <a href="{{ url_for('dashboard.tutorials') }}"><i class="fa fa-pencil-square-o" aria-hidden="true"></i> <span class="nav-label">Tutorials</span></a>
	                </li>
	                <li>
	                    <a href="{{ url_for('dashboard.faq') }}"><i class="fa fa-comments" aria-hidden="true"></i> <span class="nav-label">FAQ</span></a>
	                </li>
	                <li>
	                    <a href="{{ url_for('dashboard.news') }}"><i class="fa fa-newspaper-o" aria-hidden="true"></i> <span class="nav-label">News</span></a>
	                </li>
	            </ul>
	        </div>
	    </nav>
	    
        <div class="navbar-header navToggleBtn">
            <a class="navbar-minimalize minimalize-styl-2 btn btn-primary m-n" href="#"><i class="fa fa-bars"></i> </a>
        </div>
		
		<div class="topNav">
			<div class="row border-bottom m-n">
		        <nav class="navbar navbar-static-top white-bg" role="navigation" style="margin-bottom: 0">
			        <h2 class="pull-left m-n m-t-sm m-l-sm"><b>Octad</b></h2>

		            <ul class="nav navbar-top-links navbar-right">
                        <li class="m-r-sm">

                            {% if g.user and not g.user.is_anonymous() and g.user.is_authenticated() %}
				                <a data-toggle="dropdown" class="dropdown-toggle pull-right" href="#" style="padding:12px;" aria-expanded="true">
									<b><span id="username">{{ g.user.username }}</span></b> <b class="caret"></b>
								</a>
								<ul class="dropdown-menu userDropDownMenu m-t-xs" style="right:30px;top:30px;left:inherit;">
									<li><a href="{{ url_for('profile.change_password') }}"><i class="fa fa-user" aria-hidden="true"></i> Change Password</a></li>
									<li><a class="modalMaterial-trigger" href="{{ url_for('profile.logout') }}">
										<i class="fa fa-power-off" aria-hidden="true"></i> Logout</a>
									</li>
								</ul>
							{% else %}
								<a href="{{ url_for('profile.login') }}">
									<i class="fa fa-sign-in"></i> Login
								</a>
							{% endif %}


                        </li>
		            </ul>
		        </nav>
	        </div>
		</div>
		
		<div id="page-wrapper" class="gray-bg sideNavBody"><!-- btmNavBody -->
			<div class="wrapper wrapper-content full-height" style="width : 99%">


      <div class="row" style="margin-bottom: 5px;">
            <div class="col-lg-12">
                  <div class="ibox-content" style="border: 2px solid lightgray; border-radius: 5px;">

                        <span style="font-size: 14px;color: #0ca90c;"> <strong>Job Name : </strong> </span><span style=" margin-left: 1%;margin-right: 5%; font-weight: 900;">{{ job.name }}</span>
                        <span style="font-size: 14px;color: #0ca90c;"> <strong>Job Description : </strong> </span><span style=" margin-left: 1%;font-weight: 900;">{{ job.description }}</span>
                         <span style="float: right;"><button id="drugsFiles">Download Related Files</button></span>
                   </div>
           </div>
      </div>


<!-- Drugs Panel Start-->

        <div class="row">
                    <div class="col-lg-12">
                        <div class="ibox ">
                            <div class="ibox-title" style="background: #009ece; color: white;">
                                <h5 class="pull-left">Drugs Prediction</h5>

                            </div>
                            <div class="ibox-content">


<!--   targets pathway meshterms graph -->

			  <div class="row">
                    <div class="col-lg-4">
                        <div class="ibox ">
                            <div class="ibox-title">
                                <h5 class="pull-left">Targets</h5>
                            </div>
                            <div class="ibox-content">
                                <iframe src="/static/data/{{ job.id }}/drug_enrichedsea_targets.pdf" width="300" height="250"></iframe>
                            </div>
                        </div>
                    </div>
                       <div class="col-lg-4">
                        <div class="ibox ">
                            <div class="ibox-title">
                                <h5 class="pull-left">Pathway</h5>
                            </div>
                            <div class="ibox-content">
                               <iframe src="/static/data/{{ job.id }}/drug_enrichedchembl_targets.pdf" width="300" height="250"></iframe>
                            </div>
                        </div>
                    </div>
                      <div class="col-lg-4">
                        <div class="ibox ">
                            <div class="ibox-title">
                                <h5 class="pull-left">Mesh Term</h5>
                            </div>
                            <div class="ibox-content">
                               <iframe src="/static/data/{{ job.id }}/drug_enrichedmeshes.pdf" width="300" height="250"></iframe>
                            </div>
                        </div>
                    </div>
                </div>

<!--   Drug hits graph -->

		  <div class="row">
                    <div class="col-lg-12">
                        <div class="ibox ">
                            <div class="ibox-title">
                                <h5 class="pull-left">Drug Hits</h5>
                            </div>
                            <div class="ibox-content">
                                <iframe src="/static/data/{{ job.id }}/lincs_reverse_expression.pdf" width="1050" height="400"></iframe>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- Drugs Panel End-->


<!-- Signature Panel Start-->

        <div class="row">
            <div class="col-lg-12">
                <div class="ibox ">
                    <div class="ibox-title" style="background: #009ece; color: white;">
                        <h5 class="pull-left">Disease Signature</h5>
                    </div>
                    <div class="ibox-content">
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="ibox ">
                                   <!--  <div class="ibox-title">
                                        <h5 class="pull-left">Drug Hits</h5>
                                    </div> -->
                                    <div class="ibox-content">
                                        <iframe src="/static/data/{{ job.id }}/signature.pdf" width="1050" height="400"></iframe>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% if job.jobs.0.de_method == 'edgeR' %}
                            <div class="row">
                            <div class="col-lg-4">
                                <div class="ibox ">
                                  <!--   <div class="ibox-title">
                                        <h5 class="pull-left">Targets</h5>
                                    </div> -->
                                    <div class="ibox-content">
                                        <iframe src="/static/data/{{ job.id }}/dz_enriched_GO_Biological_Process_2017.pdf" width="300" height="250"></iframe>
                                    </div>
                                </div>
                            </div>
                               <div class="col-lg-4">
                                <div class="ibox ">
                                    <!-- <div class="ibox-title">
                                        <h5 class="pull-left">Pathway</h5>
                                    </div> -->
                                    <div class="ibox-content">
                                       <iframe src="/static/data/{{ job.id }}/dz_enriched_GO_Cellular_Component_2017.pdf" width="300" height="250"></iframe>
                                    </div>
                                </div>
                            </div>
                              <div class="col-lg-4">
                                <div class="ibox ">
                                  <!--   <div class="ibox-title">
                                        <h5 class="pull-left">Mesh Term</h5>
                                    </div> -->
                                    <div class="ibox-content">
                                       <iframe src="/static/data/{{ job.id }}/dz_enriched_KEGG_2016.pdf" width="300" height="250"></iframe>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% elif job.jobs.0.de_method == 'limma' %}
                            <div class="row">
                                <div class="col-lg-6">
                                    <div class="ibox ">
                                      <!--   <div class="ibox-title">
                                            <h5 class="pull-left">Targets</h5>
                                        </div> -->
                                        <div class="ibox-content">
                                            <iframe src="/static/data/{{ job.id }}/dz_enriched_GO_Biological_Process_2017.pdf" width="300" height="250"></iframe>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-6">
                                    <div class="ibox ">
                                        <!-- <div class="ibox-title">
                                            <h5 class="pull-left">Pathway</h5>
                                        </div> -->
                                        <div class="ibox-content">
                                           <iframe src="/static/data/{{ job.id }}/dz_enriched_GO_Cellular_Component_2017.pdf" width="300" height="250"></iframe>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>


<!-- Signature Panel End-->


<!-- Case-COntrol Panel Start-->

        <div class="row">
            <div class="col-lg-12">
                <div class="ibox ">
                    <div class="ibox-title" style="background: #009ece; color: white;">
                        <h5 class="pull-left">Control Samples</h5>
                    </div>
                    <div class="ibox-content">
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="ibox ">
                                    <div class="ibox-content">
                                        <div id="control_plot_output"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>


<!-- Case-COntrol Panel End-->

<!-- Case Panel Start-->

        <div class="row">
            <div class="col-lg-12">
                <div class="ibox ">
                    <div class="ibox-title" style="background: #009ece; color: white;">
                        <h5 class="pull-left">Case Samples</h5>
                    </div>
                    <div class="ibox-content">
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="ibox ">
                                    <div class="ibox-content">
                                        <div id="case_plot_output"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>


<!-- Case Panel End-->


<!--   Drug hits -->

				  <div class="row">
                    <div class="col-lg-12">
                        <div class="ibox ">
                            <div class="ibox-title">
                                <h5 class="pull-left">Drug Hits</h5>
                            </div>
                            <div class="ibox-content">
                                <table id="drug_hits" class="table table-striped table-bordered display nowrap" cellspacing="0" width="100%">
                                    <thead>
                                        <tr>
                                            <th>pert_iname</th>
                                            <th>clinical_phas</th>
                                            <th>MOA</th>
                                            <th>Targe</th>
                                            <th>sRGE</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                    	
                                    	<tr>
                                            <td>ABT-491</td>
                                            <td>Phase 1</td>
                                            <td>platelet activating factor receptor</td>
                                            <td>PTAFR</td>
                                            <td>-0.54(o)</td>
                                        </tr>
                                        <tr>
                                            <td>acefylline</td>
                                            <td>Launched</td>
                                            <td>adenosine receptor agonist</td>
                                            <td>ADORA1</td>
                                            <td>-0.42(o)</td>
                                        </tr>
                                       
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
			</div>
        </div>
    </div>

    <!-- Mainly scripts -->
    <script src="{{ url_for('static', filename='js/jquery-3.1.1.js') }}"></script>
    <script src="{{ url_for('static', filename='js/bootstrap.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/jquery-ui.js') }}"></script>
    <script src="{{ url_for('static', filename='js/jquery.sumoselect.js') }}"></script>


    <!-- Custom and plugin javascript -->
    <script src="{{ url_for('static', filename='js/inspinia.js') }}"></script>
    <script src="{{ url_for('static', filename='js/plugins/pace/pace.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/plugins/metisMenu/jquery.metisMenu.js') }}"></script>
    <script src="{{ url_for('static', filename='js/plugins/slimscroll/jquery.slimscroll.min.js') }}"></script>
	<!-- Multi Select -->
    <script src="{{ url_for('static', filename='js/plugins/chosen/chosen.jquery.js') }}"></script>
    <!-- Steps -->
    <script src="{{ url_for('static', filename='js/plugins/staps/jquery.steps.js') }}"></script>

    <!-- Jquery Validate -->
    <script src="{{ url_for('static', filename='js/plugins/validate/jquery.validate.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/plugins/iCheck/icheck.min.js') }}"></script>

     <!--<script src="{{ url_for('static', filename='js/dataTables.buttons.min.js') }}"></script> -->
   
	<script src="{{ url_for('static', filename='js/cstmJS.js') }}"></script>

    <!--<script src="{{ url_for('static', filename='js/clusterChart/embed.js') }}"></script>-->
    <!--<script src="{{ url_for('static', filename='js/clusterChart/require.js') }}"></script>-->
	<script data-schema="NewsArticle" type="application/ld+json" src="{{ url_for('static', filename='js/clusterChart/data.json') }}"></script>
    <script src="{{ url_for('static', filename='js/jquery.dataTables.min.js') }}"></script>
    <!-- <script src="{{ url_for('static', filename='js/dataTables.tableTools.js') }}"></script> -->
    <script src="{{ url_for('static', filename='js/dataTables.select.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/plugins/sweetalert/sweetalert.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/plotly-latest.min.js') }}"></script>


<script type="text/javascript">
    var case_plot = function(){
		Plotly.d3.csv('{{ url_for('static', filename='data_files/tsne_3d.csv') }}', (err, allRows) => {
			var x = [], y = [], xy_names=[];
			var cx = [], cy = [], cxy_names=[];
			var case_str = "{{ job.jobs.0.case_sample_id }}"
			var case_ids = new Array();
			if (case_str){
				case_ids = case_str.split(",");
			}
			for (var i=0; i<allRows.length; i++) {
				row = allRows[i];
				var rname = row[""];
				xy_names.push( rname );
				x.push( row['X'] );
				y.push( row['Y'] );
				if (case_ids.indexOf(rname) > 0){
					cxy_names.push( rname );
					cx.push( row['X'] );
					cy.push( row['Y'] );
				}
			}
			var traces = {
				x: x,
				y: y,
				name: "Others",
				type: "scatter",
				text: xy_names,
				mode: 'markers'
			};
			var cases = {
				x: cx,
				y: cy,
				name: "Cases",
				type: "scatter",
				text: cxy_names,
				mode: 'markers'
			};
			var data = [traces, cases];
			Plotly.newPlot('case_plot_output', data, {title: 'Case Visualisation'});
		})
	};

	var ctrl_plot = function(){
		Plotly.d3.csv('{{ url_for('static', filename='data_files/tsne_3d.csv') }}', (err, allRows) => {
			var x = [], y = [], xy_names=[];
			var cx = [], cy = [], cxy_names=[];
			var ctx = [], cty = [], ctxy_names=[];
			var case_str = "{{ job.jobs.0.case_sample_id }}"
			var case_ids = new Array();
			var control_str = "{{ job.jobs.0.ctrl_sample_id }}"
			var control_ids = new Array();
			if (case_str){
				case_ids = case_str.split(",");
			}
			if (control_str){
				control_ids = control_str.split(",");
			}
			for (var i=0; i<allRows.length; i++) {
				row = allRows[i];
				var rname = row[""];
				xy_names.push( rname );
				x.push( row['X'] );
				y.push( row['Y'] );
				if (case_ids.indexOf(rname) > 0){
					cxy_names.push( rname );
					cx.push( row['X'] );
					cy.push( row['Y'] );
				}
				if (control_ids.indexOf(rname) > 0){
					ctxy_names.push( rname );
					ctx.push( row['X'] );
					cty.push( row['Y'] );
				}
			}
			var traces = {
				x: x,
				y: y,
				name: "Others",
				type: "scatter",
				text: xy_names,
				mode: 'markers'
			};
			var cases = {
				x: cx,
				y: cy,
				name: "Cases",
				type: "scatter",
				text: cxy_names,
				mode: 'markers'
			};
			var controls = {
				x: ctx,
				y: cty,
				name: "Controls",
				type: "scatter",
				text: ctxy_names,
				mode: 'markers'
			};
			var data = [traces, cases, controls];
			Plotly.newPlot('control_plot_output', data, {title: 'Case Control Visualisation'});
		})
	};





$(document).ready(function(){
    case_plot();
    ctrl_plot();
});

$("#drugsFiles").click(function(){

  /*  window.location.href = "{{ url_for('static', filename='data/36/DE_genes.csv') }}";
    window.location.href = "{{ url_for('static', filename='data/36/DE_genes.csv') }}";*/


    download_files([{ download: "/" + "{{ file_name }}", filename : "{{ file_name }}"}]);
})


function download_files(files) {
      function download_next(i) {
        if (i >= files.length) {
          return;
        }
        var a = document.createElement('a');
        a.href = "/static/data/"+{{job.id}}+files[i].download;
        a.target = '_parent';
        if ('download' in a) {
          a.download = files[i].filename;
        }
        (document.body || document.documentElement).appendChild(a);
        if (a.click) {
          a.click();
        } else {
          $(a).click();
        }
        a.parentNode.removeChild(a);

        setTimeout(function() {
          download_next(i + 1);
        }, 2500);
      }
      download_next(0);
    }

</script>

</body>
</html>
