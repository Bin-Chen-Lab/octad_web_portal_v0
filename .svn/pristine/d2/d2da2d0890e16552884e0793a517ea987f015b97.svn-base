<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Octad</title>
  <link rel="shortcut icon" href="{{ url_for('static', filename='img/optraIcon.png') }}" type="image/x-icon">
  <link href="{{ url_for('static', filename='css/bootstrap.min.css') }}" rel="stylesheet">
  <link href="{{ url_for('static', filename='css/jquery-ui.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='font-awesome/css/font-awesome.css') }}" rel="stylesheet">
  <link href="{{ url_for('static', filename='css/plugins/steps/jquery.steps.css') }}" rel="stylesheet">
  <link href="{{ url_for('static', filename='css/sumoselect.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/animate.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
  <link href="{{ url_for('static', filename='css/plugins/iCheck/custom.css') }}" rel="stylesheet">
  <link href="{{ url_for('static', filename='css/jquery.dataTables.min.css') }}" rel="stylesheet">
  <link href="{{ url_for('static', filename='css/plugins/select2/select2.min.css') }}" rel="stylesheet"><!-- Auto Select -->
  <link href="{{ url_for('static', filename='css/plugins/chosen/bootstrap-chosen.css') }}" rel="stylesheet"><!-- Multi Select -->
  <link href="{{ url_for('static', filename='css/plugins/nouslider/jquery.nouislider.css') }}" rel="stylesheet"><!-- no ui slider -->
  <link href="{{ url_for('static', filename='css/plugins/switchery/switchery.css') }}" rel="stylesheet"><!-- switchery (On Off Button) -->


  <link href="{{ url_for('static', filename='css/cstm-style.css') }}" rel="stylesheet">
</head>

<body class=""><!-- mini-navbar -->
    <div id="wrapper">

      {% include 'base/navBar.html' %}

      <div class="navbar-header navToggleBtn">
        <a class="navbar-minimalize minimalize-styl-2 btn btn-primary m-n" href="#"><i class="fa fa-bars"></i> </a>
      </div>

      <div class="topNav">
        <div class="row border-bottom m-n">
          <nav class="navbar navbar-static-top white-bg" role="navigation" style="margin-bottom: 0">
            <h2 class="pull-left m-n m-t-sm m-l-sm"><b>Octad</b></h2>

              <ul class="nav navbar-top-links navbar-right">
                  <li class="m-r-sm">

                        {% if g.user and not g.user.is_anonymous() and g.user.is_authenticated() %}
                            <a data-toggle="dropdown" class="dropdown-toggle pull-right" href="#" style="padding:12px;" aria-expanded="true">
                                <b><span id="username">{{ g.user.username }}</span></b> <b class="caret"></b>
                            </a>
                            <ul class="dropdown-menu userDropDownMenu m-t-xs" style="right:30px;top:30px;left:inherit;">
                                <li><a href="{{ url_for('profile.change_password') }}"><i class="fa fa-user" aria-hidden="true"></i> Change Password</a></li>
                                <li><a class="modalMaterial-trigger" href="{{ url_for('profile.logout') }}">
                                    <i class="fa fa-power-off" aria-hidden="true"></i> Logout</a>
                                </li>
                            </ul>
                        {% else %}
                            <a href="{{ url_for('profile.login') }}">
                                <i class="fa fa-sign-in"></i> Login
                            </a>
                        {% endif %}


                    </li>
              </ul>
          </nav>
        </div>
      </div>

      <div id="page-wrapper" class="gray-bg sideNavBody"><!-- btmNavBody -->
        <div class="wrapper wrapper-content full-height">
          <div class="row m-n">
            <div class="col-lg-12" style="padding:0;">
               <div class="ibox ">
                  <div class="ibox-title">
                      <h5>Job History</h5>
                  </div>
                  <div class="ibox-content">
                    <table id="jobs" class="table table-striped table-bordered display nowrap" cellspacing="0" width="100%">
                      <thead>
                        <tr>
                          <th>Job Name</th>
                          <th>Disease</th>
                          <th>Status</th>
                          <!--<th>Total output files</th>-->
                          <th>Action</th>
                        </tr>
                      </thead>
                      <tbody></tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>


    <!-- Mainly scripts -->
    <script src="{{ url_for('static', filename='js/jquery-3.1.1.js') }}"></script>
    <script src="{{ url_for('static', filename='js/bootstrap.min.js') }}"></script>

    <script src="{{ url_for('static', filename='js/jquery-ui.js') }}"></script>

    <!-- Custom and plugin javascript -->
    <script src="{{ url_for('static', filename='js/inspinia.js') }}"></script>
    <script src="{{ url_for('static', filename='js/plugins/pace/pace.min.js') }}"></script>

    <script src="{{ url_for('static', filename='js/plugins/metisMenu/jquery.metisMenu.js') }}"></script>
    <script src="{{ url_for('static', filename='js/plugins/slimscroll/jquery.slimscroll.min.js') }}"></script>

    <!-- Jquery Validate -->
    <script src="{{ url_for('static', filename='js/plugins/validate/jquery.validate.min.js') }}"></script>

    <script src="{{ url_for('static', filename='js/jquery.dataTables.min.js') }}"></script>



  <script src="{{ url_for('static', filename='js/cstmJS.js') }}"></script>
  <!--<script src="{{ url_for('static', filename='js/cstmAngular.js') }}"></script>-->

    <script type="">
     var jobsTable;
      $(document).ready(function(){
       // var jobsTable;
       job_history();
        setInterval(function(){job_history() }, 30000);
    });

      function job_history()
      {

          $.ajax({
            url: "{{ url_for('api.userJobApi', user_id=g.user.id) }}"
        }).done(function (data) {
            var content = '';
            if(data.length > 0){
                var obj = JSON.parse(data);
                $.each(obj, function(i, item){
                    viewJob = "{{ url_for('dashboard.job_output', job_id='item') }}";
                    runJob = "{{ url_for('dashboard.dashboard') }}";
                    viewJob = viewJob.replace('item', item.id);
                    runJob = runJob + '?rerun=true&job_id=' + item.id
                    content=content + '<tr>'+
                                    '<td>'+item.job_name+'</td>'+
                                    '<td>'+item.disease+'</td>'+
                                    '<td>'+item.status+'</td>';
                                    if(item.status != 'Completed')
                                           content=content + '<td>'+
                                           '<a class="btn btn-xs btn-info m-r-xs" data-title="View" data-toggle="tooltip" style="padding:0px 6px;" disabled><i class="fa fa-eye"></i></a>' +
                                           '<a class="btn btn-xs btn-warning m-r-xs" data-title="Run" data-toggle="tooltip" href='+ runJob +' style="padding:0px 6px;"><i class="fa fa-play"></i></a>' +
                                           '</td>'+
                                           '</tr>';
                                      else if(item.status == 'Completed')
                                           content=content + '<td>' +
                                           '<a class="btn btn-xs btn-info m-r-xs" data-title="View" data-toggle="tooltip" href='+ viewJob +' style="padding:0px 6px;" ><i class="fa fa-eye"></i></a>' +
                                               '</td>'+
                                           '</tr>';
                  });
            }
            $('#jobs tbody').append(content);
            $("#jobs-loader").css("display","none");
            $("#jobs-table").css("display","block");

            jobsTable = $('#jobs').DataTable( {
                "columnDefs": [ {
                    "targets": -1,
                    "data": null,
                    "defaultContent": ''
                } ],
                ordering : false,
                columns: [
                    { "data": "id" },
                    { "data": "job_name" },
                    { "data": "disease" },
                    { "data": "staus" }
                ],
                searching : true,
                destroy : true
            });

            $("#jobs").find('.select-info').css('display','none');
            $("#jobs").wrap( "<div style='width:100%; overflow-x:auto;'></div>" );
        });
    };
    </script>
</body>
</html>
