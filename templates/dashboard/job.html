<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Octad</title>
    <link rel="shortcut icon" href="{{ url_for('static', filename='img/optraIcon.png') }}" type="image/x-icon">

    {% include 'base/css_links.html' %}
</head>

<body class=""><!-- mini-navbar -->
    <div id="wrapper">

      {% include 'base/navBar.html' %}

      <div class="navbar-header navToggleBtn">
        <a class="navbar-minimalize minimalize-styl-2 btn btn-primary m-n" href="#"><i class="fa fa-bars"></i> </a>
      </div>

      {% include 'base/header.html' %}

      <div id="page-wrapper" class="gray-bg sideNavBody"><!-- btmNavBody -->
        <div class="wrapper wrapper-content full-height">
          <div class="row m-n">
            <div class="col-lg-12" style="padding:0;">
               <div class="ibox ">
                  <div class="ibox-title">
                      <h5>Job History</h5>
                  </div>
                  <div class="ibox-content">
                    <table id="jobs" class="table table-striped table-bordered display nowrap" cellspacing="0" width="100%">
                      <thead>
                        <tr>
                          <th>Job Name</th>
                          <th>Disease</th>
                          <th>Status</th>
                          <th>Creation Time</th>
                          <th>Action</th>
                        </tr>
                      </thead>
                      <tbody></tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        {% include 'base/footer.html' %}
      </div>

      {% include 'base/js_links.html' %}

    <script type="">
     var jobsTable;
      $(document).ready(function(){
       // var jobsTable;
        job_history();
        setInterval(function(){job_history() }, 30000);
      });

      function job_history(){

          $.ajax({
            url: "{{ url_for('api.userJobApi', user_id=g.user.id) }}"
          }).done(function (data) {
            var content = '';
            if(data.length > 0){
                var obj = JSON.parse(data);
                $.each(obj, function(i, item){
                    viewJob = "{{ url_for('dashboard.job_output', job_id='item') }}";
                    runJob = "{{ url_for('dashboard.dashboard') }}";
                    viewJob = viewJob.replace('item', item.id);
                    runJob = runJob + '?rerun=true&job_id=' + item.id
                    content=content + '<tr>'+
                                    '<td>'+item.job_name+'</td>'+
                                    '<td>'+item.disease+'</td>'+
                                    '<td>'+item.status+'</td>'+
                                    '<td>'+item.creationTime+'</td>';
                                    if(item.status != 'Completed')
                                           content=content + '<td>'+
                                           '<a class="btn btn-xs btn-info m-r-xs" data-title="View" data-toggle="tooltip" style="padding:0px 6px;" disabled><i class="fa fa-eye"></i></a>' +
                                           //'<a class="btn btn-xs btn-warning m-r-xs" data-title="Run" data-toggle="tooltip" href='+ runJob +' style="padding:0px 6px;"><i class="fa fa-play"></i></a>' +
                                           '</td>'+
                                           '</tr>';
                                      else if(item.status == 'Completed')
                                           content=content + '<td>' +
                                           '<a class="btn btn-xs btn-info m-r-xs" data-title="View" data-toggle="tooltip" href='+ viewJob +' style="padding:0px 6px;" ><i class="fa fa-eye"></i></a>' +
                                               '</td>'+
                                           '</tr>';
                  });
            }
            $('#jobs tbody').append(content);
            $("#jobs-loader").css("display","none");
            $("#jobs-table").css("display","block");

            jobsTable = $('#jobs').DataTable( {
                "columnDefs": [ {
                    "targets": -1,
                    "data": null,
                    "defaultContent": ''
                } ],
                ordering : false,
                columns: [
                    { "data": "id" },
                    { "data": "job_name" },
                    { "data": "disease" },
                    { "data": "staus" },
                    { "data": "creationTime" }
                ],
                searching : true,
                destroy : true
            });

            $("#jobs").find('.select-info').css('display','none');
            $("#jobs").wrap( "<div style='width:100%; overflow-x:auto;'></div>" );
        });
    };
    </script>
</body>
</html>
